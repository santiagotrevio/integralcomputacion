<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/LOGO SIN TEXTO.png">
    <title>Cat√°logo de Productos | Integral Computaci√≥n</title>
    <meta name="description"
        content="Consulta nuestro cat√°logo de t√≥ners, papeler√≠a y accesorios. Encuentra el c√≥digo que necesitas.">

    <!-- Performance: Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- FontAwesome (Defer Render Blocking) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </noscript>

    <style>
        /* Specific Styles for Catalog Page */
        .catalog-hero {
            position: relative;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            overflow: hidden;
            border-radius: 0 0 50px 50px;
            /* Optional fancy border */
        }

        .catalog-hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            filter: brightness(0.4);
            /* Darken for text readability */
        }

        .catalog-title-wrapper {
            position: relative;
            z-index: 10;
            padding: 2rem;
        }

        .catalog-title-wrapper h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .search-container {
            margin-top: -30px;
            /* Overlap hero */
            margin-bottom: 3rem;
            position: relative;
            z-index: 20;
            padding: 0 1rem;
        }

        .search-box {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--ic-font);
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--ic-cyan);
        }

        .filter-select {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--ic-font);
            outline: none;
            cursor: pointer;
        }

        /* PRODUCT TABLE LISTING */
        .catalog-grid {
            margin-bottom: 6rem;
        }

        .product-list-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 1.5rem;
            align-items: center;
            border: 1px solid #f1f5f9;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .product-list-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            border-color: var(--ic-cyan);
        }

        .prod-image {
            width: 80px;
            height: 80px;
            background: #f8fafc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 1.5rem;
        }

        .prod-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .prod-info h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--ic-dark-gray);
            margin-bottom: 0.25rem;
        }

        .prod-code {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--ic-magenta);
            background: rgba(216, 27, 96, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 0.5rem;
        }

        .prod-desc {
            font-size: 0.9rem;
            color: var(--ic-text-gray);
        }

        .prod-action .btn-card {
            background: var(--ic-light-gray);
            color: var(--ic-dark-gray);
            font-size: 0.85rem;
        }

        .prod-action .btn-card:hover {
            background: var(--ic-cyan);
            color: white;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .product-list-card {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1rem;
            }

            .prod-image {
                margin: 0 auto;
            }

            header {
                padding-top: 0 !important;
                margin-top: 0 !important;
                top: 0 !important;
                height: auto !important;
                box-shadow: none !important;
                /* Remove shadow */
                z-index: 2000 !important;
                /* Ensure on top */
                background: white !important;
            }

            /* Hide potential overlay sources */
            header::before,
            header::after,
            body::before,
            body::after,
            .header-top-line::before,
            .header-top-line::after {
                display: none !important;
                content: none !important;
                height: 0 !important;
                width: 0 !important;
            }

            body,
            html {
                margin-top: 0 !important;
                padding-top: 0 !important;
            }

            .nav-container {
                height: auto !important;
                min-height: 60px !important;
                padding-top: 5px !important;
                padding-bottom: 5px !important;
            }

            .search-box {
                flex-direction: column;
            }

            .filter-select {
                width: 100%;
            }

            .catalog-hero {
                height: 300px;
            }

            .catalog-title-wrapper h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>

    <!-- Header (Same as index) -->
    <header>
        <div class="header-top-line"></div>
        <div class="nav-container">
            <div class="logo-wrapper">
                <a href="index.html" class="logo" aria-label="Integral Computaci√≥n Inicio">
                    <img src="assets/images/logo.svg" alt="Integral Computaci√≥n" width="180" height="50">
                </a>
            </div>
            <!-- Simple Back Link/Menu -->
            <nav class="nav-links">
                <a href="index.html">‚Üê Volver al Inicio</a>
            </nav>

            <div style="display: flex; gap: 1rem; align-items: center;">
                <a href="carrito.html" class="header-btn"
                    style="background: white; color: var(--ic-cyan); border: 2px solid var(--ic-cyan); position: relative;">
                    <i class="fa-solid fa-cart-shopping"></i> Mi Lista
                    <span id="cartCount" class="cart-count">0</span>
                </a>
                <a href="https://wa.me/523312680092" target="_blank" class="header-btn">
                    Cotizar <i class="fa-brands fa-whatsapp"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Catalog Hero -->
    <section class="catalog-hero">
        <img src="assets/images/hero-products-bg.jpg" class="catalog-hero-bg" alt="Fondo Cat√°logo"
            onerror="this.src='https://images.unsplash.com/photo-1497366216548-37526070297c?q=80&w=1200'">

        <div class="catalog-title-wrapper">
            <h1 id="pageTitle">Cat√°logo de Productos</h1>
            <p>Encuentra el c√≥digo exacto de lo que necesitas para tu oficina.</p>
        </div>
    </section>

    <!-- Main Content Area with Sidebar -->
    <div class="container main-layout">

        <!-- Mobile Filter Toggle -->
        <button class="mobile-filter-btn" onclick="toggleMobileFilters()">
            <i class="fa-solid fa-filter"></i> Filtrar <span id="filterCount" class="filter-count"
                style="display:none">0</span>
        </button>

        <!-- Sidebar Filters -->
        <aside class="sidebar" id="filterSidebar">
            <div class="sidebar-header mobile-only">
                <h3>Filtros</h3>
                <button onclick="toggleMobileFilters()" class="close-filters"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <!-- Search in Sidebar (Optional or keep top?) Let's keep a search input here too or rely on top? 
                 Let's keep the main search at the top, but maybe add small categories here. -->

            <div class="filter-group">
                <h4>Categor√≠as</h4>
                <div class="filter-options">
                    <label class="filter-check">
                        <input type="radio" name="category" value="all" checked onchange="filterProducts()">
                        <span>Todas</span>
                    </label>
                    <label class="filter-check">
                        <input type="radio" name="category" value="toner" onchange="filterProducts()">
                        <span>T√≥ners</span>
                    </label>
                    <label class="filter-check">
                        <input type="radio" name="category" value="papeleria" onchange="filterProducts()">
                        <span>Papeler√≠a</span>
                    </label>
                    <label class="filter-check">
                        <input type="radio" name="category" value="accesorios" onchange="filterProducts()">
                        <span>Accesorios</span>
                    </label>
                </div>
            </div>

            <div class="filter-group">
                <h4>Marcas</h4>
                <div class="filter-options" id="brandOptions">
                    <!-- Din√°mico -->
                </div>
            </div>

            <button class="apply-filters-btn mobile-only" onclick="toggleMobileFilters()">Ver Resultados</button>
        </aside>

        <!-- Product Listing Area -->
        <main class="product-area">
            <!-- Top Search & Sort Bar -->
            <div class="search-sort-bar">
                <div class="search-box-wrapper">
                    <i class="fa-solid fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input-modern"
                        placeholder="Buscar producto (ej. Toner 85A)..." oninput="filterProducts()">
                </div>

                <div class="sort-wrapper">
                    <span class="sort-label">Ordenar:</span>
                    <select id="sortFilter" onchange="filterProducts()" class="sort-select">
                        <option value="relevance">Relevancia</option>
                        <option value="az">Nombre (A-Z)</option>
                        <option value="za">Nombre (Z-A)</option>
                    </select>
                </div>
            </div>
            <div id="activeFilters" class="active-filters"></div>

            <p id="resultCount" style="color: #64748b; font-weight: 600; font-size: 0.95rem; margin-bottom: 1rem;">
                Cargando...</p>

            <div id="productGrid" class="catalog-grid">
                <!-- Products injected here -->
            </div>
        </main>
    </div>

    <!-- Mobile Overlay -->
    <div class="filter-overlay" onclick="toggleMobileFilters()"></div>

    <style>
        /* New Layout Styles */
        .main-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: 2rem;
            margin-bottom: 4rem;
            align-items: start;
        }

        /* Search Sort Bar */
        .search-sort-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border: 1px solid #f1f5f9;
        }

        .search-box-wrapper {
            position: relative;
            flex: 1;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        .search-input-modern {
            width: 100%;
            padding: 10px 10px 10px 36px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: var(--ic-font);
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-input-modern:focus {
            border-color: var(--ic-cyan);
        }

        .sort-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sort-select {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px 12px;
            font-family: var(--ic-font);
            color: var(--ic-dark-gray);
            cursor: pointer;
            outline: none;
            background: #f8fafc;
        }

        /* Sidebar Styling */
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #f1f5f9;
            position: sticky;
            top: 20px;
            /* Offset for sticky header */
            height: fit-content;
        }

        .filter-group {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #f1f5f9;
            padding-bottom: 1rem;
        }

        .filter-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .filter-group h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--ic-dark-gray);
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .filter-check {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--ic-text-gray);
            transition: color 0.2s;
        }

        .filter-check:hover {
            color: var(--ic-cyan);
        }

        .filter-check input[type="checkbox"],
        .filter-check input[type="radio"] {
            accent-color: var(--ic-cyan);
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        /* Mobile specific hidden elements */
        .mobile-only {
            display: none;
        }

        .mobile-filter-btn {
            display: none;
        }

        .filter-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1099;
        }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .search-sort-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-box-wrapper,
            .sort-wrapper {
                width: 100%;
            }

            .sort-wrapper {
                justify-content: space-between;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: -320px;
                /* Hidden by default */
                width: 300px;
                height: 100vh;
                z-index: 1100;
                border-radius: 0;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
                overflow-y: auto;
                transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .sidebar.active {
                left: 0;
            }

            .filter-overlay.active {
                display: block;
            }

            .mobile-only {
                display: flex;
            }

            /* Show headers/close buttons */

            .sidebar-header {
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid #eee;
            }

            .close-filters {
                background: none;
                border: none;
                font-size: 1.5rem;
                color: #64748b;
            }

            .mobile-filter-btn {
                display: flex;
                align-items: center;
                gap: 8px;
                background: white;
                border: 1px solid #e2e8f0;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 700;
                color: var(--ic-dark-gray);
                margin-bottom: 1rem;
                width: 100%;
                justify-content: center;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                font-size: 1rem;
            }

            .filter-count {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                background: var(--ic-cyan);
                color: white;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                font-size: 0.75rem;
            }

            .apply-filters-btn {
                width: 100%;
                padding: 14px;
                background: var(--ic-dark-gray);
                color: white;
                border: none;
                border-radius: 8px;
                font-weight: 700;
                margin-top: 2rem;
                font-size: 1rem;
                cursor: pointer;
            }
        }
    </style>

    <!-- Footer (Simplified) -->
    <footer class="footer" style="padding-top: 2rem;">
        <div class="container">
            <div class="footer-bottom" style="border: none;">
                <p>&copy; 2026 Integral Computaci√≥n. Guadalajara.</p>
                <div class="footer-legal-links">
                    <a href="aviso-de-privacidad.html">Aviso de Privacidad</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Chatbot Intelligent Module -->
    <!-- Note: productos.js must be loaded before -->
    <script src="assets/js/integral-bot.js"></script>
    <div id="smart-agent" class="smart-agent" style="display:none !important">
        <!-- Chat Window -->
        <div class="agent-window" id="agentWindow">
            <div class="agent-header">
                <div class="agent-avatar">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div class="agent-info">
                    <h4>Asistente Integral</h4>
                    <span class="status-dot"></span> En l√≠nea
                </div>
                <button class="agent-close" onclick="toggleAgent()">√ó</button>
            </div>

            <div class="agent-body">
                <div class="msg-bot">
                    <p>Hola üëã, soy tu asistente virtual. ¬øEn qu√© puedo ayudarte hoy?</p>
                </div>

                <div class="agent-options">
                    <button onclick="agentAction('search')">
                        <i class="fa-solid fa-magnifying-glass"></i> Buscar un producto
                    </button>
                    <button onclick="agentAction('quote')">
                        <i class="fa-solid fa-file-invoice"></i> Cotizar mi lista
                    </button>
                    <button onclick="agentAction('human')">
                        <i class="fa-brands fa-whatsapp"></i> Hablar con un asesor
                    </button>
                </div>
            </div>

            <div class="agent-footer">
                <small>Respondemos en minutos</small>
            </div>
        </div>

        <!-- Trigger Button -->
        <button class="agent-trigger" onclick="toggleAgent()" aria-label="Abrir asistente">
            <span class="agent-badge" id="agentBadge" style="display:none">1</span>
            <i class="fa-solid fa-comment-dots" id="agentIcon"></i>
        </button>
    </div>

    <!-- Agent Styles -->
    <style>
        .smart-agent {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            font-family: var(--ic-font, sans-serif);
        }

        .agent-trigger {
            width: 60px;
            height: 60px;
            background: var(--ic-cyan);
            color: white;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .agent-trigger:hover {
            transform: scale(1.1);
        }

        .agent-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 12px;
            font-weight: bold;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            animation: bounce 2s infinite;
        }

        .agent-window {
            position: absolute;
            bottom: 80px;
            /* Above button */
            right: 0;
            width: 320px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            pointer-events: none;
            transition: all 0.3s ease;
            transform-origin: bottom right;
        }

        .agent-window.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .agent-header {
            background: linear-gradient(135deg, var(--ic-blue), var(--ic-cyan));
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .agent-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .agent-info h4 {
            font-size: 1rem;
            margin: 0;
            font-weight: 700;
        }

        .agent-info {
            flex: 1;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            margin-right: 4px;
        }

        .agent-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.8;
        }

        .agent-body {
            padding: 1.5rem;
            background: #f8fafc;
        }

        .msg-bot {
            background: white;
            padding: 12px;
            border-radius: 12px 12px 12px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #334155;
            position: relative;
        }

        .msg-bot::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -8px;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-right-color: white;
            border-bottom: 0;
        }

        .agent-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .agent-options button {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 12px;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            font-family: inherit;
            color: var(--ic-dark-gray);
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .agent-options button:hover {
            background: var(--ic-cyan);
            color: white;
            border-color: var(--ic-cyan);
            transform: translateX(5px);
        }

        .agent-options button i {
            color: var(--ic-cyan);
            font-size: 1.1rem;
        }

        .agent-options button:hover i {
            color: white;
        }

        .agent-footer {
            padding: 10px;
            text-align: center;
            background: white;
            border-top: 1px solid #f1f5f9;
            color: #94a3b8;
            font-size: 0.8rem;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* Mobile Adjustments */
        @media (max-width: 480px) {
            .agent-window {
                width: calc(100vw - 40px);
                right: -10px;
                bottom: 90px;
            }
        }
    </style>


    const badge = document.getElementById('agentBadge');
    const icon = document.getElementById('agentIcon');

    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <img id="lightbox-img" src="" alt="Zoom Producto">
    </div>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="scroll-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <!-- Toast Notification Container -->
    <div id="toast-container"
        style="position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; flex-direction: column; gap: 10px; align-items: center; pointer-events: none;">
    </div>

    <!-- CUSTOM STYLES FOR UX IMPROVEMENTS -->
    <style>
        /* Sticky Search Bar */
        .search-container.sticky {
            position: sticky;
            top: 10px;
            z-index: 100;
            margin-top: 10px;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .search-container.sticky .search-box {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        /* Skeleton Loading */
        .skeleton-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 1.5rem;
            align-items: center;
            border: 1px solid #f1f5f9;
        }

        .skeleton-box {
            background: linear-gradient(90deg, #f0f9ff 25%, #e0f2fe 50%, #f0f9ff 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 6px;
        }

        /* Brand Colors (Subtle border accent) */
        .brand-brother {
            border-left: 4px solid #007bc0 !important;
        }

        .brand-canon {
            border-left: 4px solid #cc0000 !important;
        }

        .brand-lexmark {
            border-left: 4px solid #009639 !important;
        }

        .brand-hp {
            border-left: 4px solid #0096d6 !important;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Staggered Fade-in Animation */
        .product-list-card {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.4s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Search Highlight */
        .highlight {
            background-color: var(--ic-yellow);
            color: var(--ic-dark-gray);
            padding: 0 2px;
            border-radius: 2px;
            font-weight: bold;
        }

        /* Copy Button */
        .copy-btn {
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            margin-left: 8px;
            transition: color 0.2s;
        }

        .copy-btn:hover {
            color: var(--ic-cyan);
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .lightbox.active {
            opacity: 1;
            pointer-events: auto;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .lightbox.active img {
            transform: scale(1);
        }

        /* Scroll to Top */
        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            left: 30px;
            /* Left side to balance WA button */
            width: 50px;
            height: 50px;
            background: white;
            color: var(--ic-dark-gray);
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 990;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-to-top.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .scroll-to-top:hover {
            background: var(--ic-cyan);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        /* Cart Count Style */
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--ic-magenta);
            color: white;
            font-size: 0.75rem;
            font-weight: 800;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Cart Pop Animation */
        @keyframes cart-pop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.5);
            }

            100% {
                transform: scale(1);
            }
        }

        .cart-bump {
            animation: cart-pop 0.3s ease-out;
        }

        /* Toast Notification Styles */
        .toast {
            background: rgba(15, 23, 42, 0.95);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-family: var(--ic-font);
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideUpFade 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: auto;
        }

        @keyframes slideUpFade {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast.hiding {
            opacity: 0 !important;
            transform: translateY(-20px) !important;
            transition: all 0.5s ease !important;
            animation: none !important;
        }

        .prod-action {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
        }

        .btn-card,
        .btn-add-cart {
            display: block;
            text-align: center;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            font-family: var(--ic-font);
        }

        /* Direct Quote Button */
        .btn-card {
            background: var(--ic-light-gray);
            color: var(--ic-dark-gray);
            font-size: 0.85rem;
        }

        .btn-card:hover {
            background: var(--ic-dark-gray);
            color: white;
        }

        /* Add to Cart Button */
        .btn-add-cart {
            background: transparent;
            border: 2px solid var(--ic-cyan);
            color: var(--ic-cyan);
            font-size: 0.85rem;
        }

        .btn-add-cart:hover {
            background: var(--ic-cyan);
            color: white;
        }

        .btn-add-cart.added {
            background: var(--ic-magenta);
            border-color: var(--ic-magenta);
            color: white;
            cursor: default;
        }

        @media (min-width: 768px) {
            .prod-action {
                flex-direction: row;
                justify-content: flex-end;
            }

            .skeleton-card {
                grid-template-columns: 80px 1fr auto;
            }
        }

        @media (max-width: 768px) {
            .skeleton-card {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>

    <!-- SCRIPTS -->
    <!-- Load Products Database (JSON format) -->
    <script src="assets/js/productos.js"></script>

    <script>
        // DOM Elements
        const productGrid = document.getElementById('productGrid');
        const searchInput = document.getElementById('searchInput');
        // categoryFilter removed (now radios)
        const sortFilter = document.getElementById('sortFilter');
        const pageTitle = document.getElementById('pageTitle');
        const cartCountEl = document.getElementById('cartCount');
        const resultCount = document.getElementById('resultCount');
        const toastContainer = document.getElementById('toast-container');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const scrollToTopBtn = document.getElementById('scrollToTop');


        let cart = JSON.parse(localStorage.getItem('quoteCart')) || [];

        function getBrand(p) {
            if (p.brand) return p.brand;
            const n = p.name ? p.name.toLowerCase() : '';
            if (n.includes('brother') || n.includes('br-')) return 'Brother';
            if (n.includes('canon')) return 'Canon';
            if (n.includes('lexmark') || n.includes('lx-')) return 'Lexmark';
            if (n.includes('hp')) return 'HP';
            if (n.includes('xerox')) return 'Xerox';
            return 'Otros';
        }

        // --- SOUND & UX UTILS ---
        function playSuccessSound() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.type = 'sine'; // Clean beep
                osc.frequency.setValueAtTime(500, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1); // Pitch up "bling"

                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);

                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.15);
            } catch (e) { console.warn("Audio error", e); }
        }

        function playCopySound() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, ctx.currentTime);
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            } catch (e) { }
        }

        function showToast(message, icon = 'fa-check-circle') {
            toastContainer.innerHTML = '';

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i class="fa-solid ${icon}" style="color: #4ade80;"></i> <span>${message}</span>`;

            toastContainer.appendChild(toast);

            setTimeout(() => {
                if (toast && toast.parentElement) {
                    toast.classList.add('hiding');
                    // Fallback to ensure removal if transition fails
                    setTimeout(() => {
                        if (toast.parentElement) toast.remove();
                    }, 600);
                }
            }, 2000);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast(`C√≥digo copiado: ${text}`, 'fa-clipboard-check');
                playCopySound();
            });
        }

        function openLightbox(src) {
            lightboxImg.src = src;
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
        }

        // ------------------------

        function updateCartCount() {
            cartCountEl.innerText = cart.length;
        }

        function toggleCart(prodId) {
            const product = productsDB.find(p => p.id === prodId);
            if (!product) return;

            const index = cart.findIndex(item => item.id === prodId);
            const btn = document.getElementById(`add-btn-${prodId}`);

            if (index === -1) {
                // Add to cart
                cart.push(product);
                if (btn) {
                    btn.classList.add('added');
                    btn.innerHTML = '<i class="fa-solid fa-check"></i> Quitar';
                    btn.style.backgroundColor = 'var(--ic-magenta)';
                    btn.style.color = 'white';
                    btn.style.borderColor = 'var(--ic-magenta)';
                }

                playSuccessSound();
                cartCountEl.classList.add('cart-bump');
                setTimeout(() => cartCountEl.classList.remove('cart-bump'), 300);
                showToast(`Agregado: ${product.name.substring(0, 25)}...`);

            } else {
                // Remove from cart
                cart.splice(index, 1);
                if (btn) {
                    btn.classList.remove('added');
                    btn.innerHTML = '<i class="fa-solid fa-plus"></i> Agregar';
                    btn.style.backgroundColor = 'transparent';
                    btn.style.color = 'var(--ic-cyan)';
                    btn.style.borderColor = 'var(--ic-cyan)';
                }
            }

            localStorage.setItem('quoteCart', JSON.stringify(cart));
            updateCartCount();
        }

        function highlightText(text, query) {
            if (!query) return text;
            const words = query.split(/\s+/).filter(w => w.length > 0);
            let highlighted = text;
            words.forEach(word => {
                const regex = new RegExp(`(${word})`, 'gi');
                highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
            });
            return highlighted;
        }

        function getBrandClass(name) {
            const n = name.toLowerCase();
            if (n.includes('brother') || n.includes('br-')) return 'brand-brother'; // Blue
            if (n.includes('canon')) return 'brand-canon'; // Red
            if (n.includes('lexmark') || n.includes('lx-')) return 'brand-lexmark'; // Green
            if (n.includes('hp')) return 'brand-hp'; // Blue HP
            return '';
        }

        // Show Skeleton Loader
        function showSkeleton() {
            let html = '';
            for (let i = 0; i < 6; i++) {
                html += `
                    <div class="skeleton-card">
                        <div class="skeleton-box" style="width:80px; height:80px;"></div>
                        <div style="width:100%">
                            <div class="skeleton-box" style="width:80px; height:20px; margin-bottom:10px;"></div>
                            <div class="skeleton-box" style="width:60%; height:24px; margin-bottom:10px;"></div>
                            <div class="skeleton-box" style="width:90%; height:16px;"></div>
                        </div>
                        <div class="skeleton-box" style="width:100px; height:40px;"></div>
                    </div>
                `;
            }
            productGrid.innerHTML = html;
        }

        // Function to Load Products (from JS file)
        function loadProducts() {
            showSkeleton(); // Show loading state

            // Simulate slight delay to see animations for demo
            setTimeout(() => {
                if (typeof productsDB !== 'undefined' && Array.isArray(productsDB)) {
                    console.log("Products Loaded from JS:", productsDB.length);

                    // Check for Add Action from Bot
                    const urlParams = new URLSearchParams(window.location.search);
                    const addId = urlParams.get('add');
                    if (addId) {
                        const product = productsDB.find(p => p.id === addId);
                        if (product) {
                            // Check if already in cart to avoid toggling off
                            const inCart = cart.some(item => item.id === addId);
                            if (!inCart) {
                                toggleCart(addId);
                                showToast(`¬°${product.name} agregado a tu lista!`, 'fa-cart-plus');
                            }
                            // Clean URL
                            const newUrl = window.location.pathname + window.location.search.replace(/[\?&]add=[^&]+/, '').replace(/^&/, '?');
                            window.history.replaceState({}, '', newUrl);
                        }
                    }

                    renderBrandOptions();
                    filterProducts();
                } else {
                    console.error("Error: productsDB not found.");
                    productGrid.innerHTML = `
                        <div style="text-align:center; padding: 2rem; color: #dc2626; background: #fef2f2; border-radius: 12px;">
                            <i class="fa-solid fa-triangle-exclamation" style="font-size: 2.5rem; margin-bottom: 1rem;"></i>
                            <h3>Error de Datos</h3>
                            <p>No se pudo cargar la base de datos de productos.</p>
                        </div>
                    `;
                }
            }, 300);
        }

        // Render Logic
        function renderProducts(products) {
            const searchTerm = searchInput.value.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            productGrid.innerHTML = '';

            // Update Result Count
            if (resultCount) {
                resultCount.innerText = `${products.length} producto${products.length !== 1 ? 's' : ''} encontrado${products.length !== 1 ? 's' : ''}`;
            }

            if (products.length === 0) {
                productGrid.innerHTML = `
                    <div style="text-align:center; padding: 4rem; color: #94a3b8;">
                        <i class="fa-regular fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <p>No encontramos productos con esa b√∫squeda.</p>
                    </div>
                `;
                return;
            }

            products.forEach((prod, index) => {
                let icon = 'fa-box';
                if (prod.category === 'toner') icon = 'fa-print';
                if (prod.category === 'papeleria') icon = 'fa-pen-ruler';
                if (prod.category.includes('accesorios')) icon = 'fa-keyboard';

                // Check if in cart for button state
                const isInCart = cart.some(item => item.id === prod.id);
                const btnClass = isInCart ? 'btn-add-cart added' : 'btn-add-cart';
                const btnText = isInCart ? '<i class="fa-solid fa-check"></i> Quitar' : '<i class="fa-solid fa-plus"></i> Agregar';
                const btnStyle = isInCart ? 'background-color: var(--ic-magenta); color: white; border-color: var(--ic-magenta);' : '';

                const card = document.createElement('div');
                // Removed brandClass dependency for cleaner look, now using logos
                card.className = `product-list-card`;

                // Add staggered animation delay
                card.style.animationDelay = `${index * 0.05}s`;

                // Image Handling
                let imgHtml = `<i class="fa-solid ${icon}"></i>`;
                let imgClick = '';
                const v = Date.now();
                if (prod.image && prod.image.trim() !== '') {
                    const imgSrc = `${prod.image}?v=${v}`;
                    imgHtml = `<img src="${imgSrc}" alt="${prod.name}" loading="lazy" onerror="this.onerror=null;this.parentNode.innerHTML='<i class=\\'fa-solid ${icon}\\'></i>'">`;
                    imgClick = `onclick="openLightbox('${imgSrc}')" style="cursor: zoom-in;"`;
                }

                // Brand Logo Logic
                const brandName = prod.brand || "Otros";
                let brandLogoUrl = getBrandLogo(brandName);
                if (brandLogoUrl) brandLogoUrl += `?v=${v}`;
                const badgeHtml = (brandLogoUrl && brandName !== 'Otros') ?
                    `<div class="brand-badge" title="${brandName}">
                        <img src="${brandLogoUrl}" alt="${brandName}" onerror="this.parentNode.style.display='none'">
                     </div>` : '';

                // Highlight Text Logic
                const nameHighlighted = highlightText(prod.name, searchTerm);

                card.innerHTML = `
                    ${badgeHtml}
                    <div class="prod-image" ${imgClick}>
                        ${imgHtml}
                    </div>
                    <div class="prod-info">
                        <span class="prod-code">
                            ${prod.id}
                            <button class="copy-btn" onclick="copyToClipboard('${prod.id}')" title="Copiar c√≥digo">
                                <i class="fa-regular fa-copy"></i>
                            </button>
                        </span>
                        <h3>${nameHighlighted}</h3>
                        <p class="prod-desc">${prod.description}</p>
                        ${prod.compatibility ? `<p style="font-size:0.8rem; color:var(--ic-magenta); margin-top:5px;"><b>Compatible con:</b> ${prod.compatibility}</p>` : ''}
                    </div>
                    <div class="prod-action">
                         <button id="add-btn-${prod.id}" onclick="toggleCart('${prod.id}')" class="${btnClass}" style="${btnStyle}">
                            ${btnText}
                        </button>
                         <a href="https://wa.me/523312680092?text=Hola,%20me%20interesa%20el%20producto%20con%20c√≥digo:%20${prod.id}" 
                           target="_blank" 
                           class="btn-card">
                           Cotizar
                        </a>
                    </div>
                `;
                productGrid.appendChild(card);
            });
        }

        function renderBrandOptions() {
            const container = document.getElementById('brandOptions');
            if (!container) return;

            const brands = [...new Set(productsDB.map(p => p.brand).filter(b => b && b !== 'Otros' && b.trim() !== ''))].sort();

            container.innerHTML = brands.map(brand => `
                <label class="filter-check">
                    <input type="checkbox" name="brand" value="${brand}" onchange="filterProducts()">
                    <span>${brand}</span>
                </label>
            `).join('') + `
                <label class="filter-check">
                    <input type="checkbox" name="brand" value="Otros" onchange="filterProducts()">
                    <span>Otros</span>
                </label>
            `;
        }

        // Helper for Logos
        function getBrandLogo(brandName) {
            // Priority: Local Optimized PNGs
            const cleanName = brandName.toLowerCase().trim();
            if (!cleanName || cleanName === 'otros') return null;

            return `assets/images/brands/${cleanName.replace(/[^a-z0-9]/g, '')}.png`;
        }

        function filterProducts() {
            const searchTerm = searchInput.value.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const searchWords = searchTerm.split(/\s+/).filter(w => w.length > 0);

            // Get selected Category (Radio)
            const catRadio = document.querySelector('input[name="category"]:checked');
            const categoryValue = catRadio ? catRadio.value : 'all';

            // Get selected Brands (Checkboxes)
            const checkedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value.toLowerCase());

            const sortValue = sortFilter.value;

            let filtered = productsDB.filter(prod => {
                if (!prod.name) return false;

                // 1. Text Search (Check if ALL search words are present)
                const prodName = prod.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const prodId = prod.id.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const prodDesc = prod.description ? prod.description.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") : "";
                const prodComp = prod.compatibility ? prod.compatibility.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") : "";
                const prodBrand = prod.brand ? prod.brand.toLowerCase() : "";

                const combinedData = `${prodId} ${prodName} ${prodDesc} ${prodComp} ${prodBrand}`;
                const matchesSearch = searchWords.every(word => combinedData.includes(word));

                // 2. Category
                const matchesCategory = categoryValue === 'all' || prod.category === categoryValue;

                // 3. Brand (Multi-select)
                let matchesBrand = true;
                if (checkedBrands.length > 0) {
                    const prodBrand = getBrand(prod).toLowerCase();
                    matchesBrand = checkedBrands.includes(prodBrand);
                    // Handle "otros" if needed broadly or specific brand matching logic
                    if (checkedBrands.includes('otros') && !['brother', 'canon', 'hp', 'lexmark', 'xerox'].includes(prodBrand)) {
                        matchesBrand = true;
                    }
                }

                return matchesSearch && matchesCategory && matchesBrand;
            });

            // Update Filter Count UI for Mobile
            const filterCountEl = document.getElementById('filterCount');
            const totalFilters = (categoryValue !== 'all' ? 1 : 0) + checkedBrands.length;
            if (filterCountEl) {
                filterCountEl.innerText = totalFilters;
                filterCountEl.style.display = totalFilters > 0 ? 'inline-flex' : 'none';
            }

            // Sorting Logic
            if (sortValue === 'az') {
                filtered.sort((a, b) => a.name.localeCompare(b.name, 'es', { sensitivity: 'base' }));
            } else if (sortValue === 'za') {
                filtered.sort((a, b) => b.name.localeCompare(a.name, 'es', { sensitivity: 'base' }));
            }
            // Brand sort is less relevant with checkbox filters but can keep if desired
            else if (sortValue === 'brand') {
                filtered.sort((a, b) => {
                    const brandA = getBrand(a);
                    const brandB = getBrand(b);
                    return brandA.localeCompare(brandB) || a.name.localeCompare(b.name, 'es', { sensitivity: 'base' });
                });
            }

            renderProducts(filtered);
            renderActiveFilters();
        }

        // Active Filters Chip Logic
        function renderActiveFilters() {
            const container = document.getElementById('activeFilters');
            if (!container) return;
            container.innerHTML = '';

            const searchTerm = searchInput.value.trim();
            const catRadio = document.querySelector('input[name="category"]:checked');
            const checkedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked'));
            let hasFilters = false;

            // Search Filter
            if (searchTerm) {
                hasFilters = true;
                container.appendChild(createChip(`"${searchTerm}"`, () => {
                    searchInput.value = '';
                    filterProducts();
                }));
            }

            // Category Filter (only show if not 'all')
            if (catRadio && catRadio.value !== 'all') {
                hasFilters = true;
                // Map values to readable labels if needed
                const catLabels = {
                    'toner': 'T√≥ners',
                    'papeleria': 'Papeler√≠a',
                    'accesorios': 'Accesorios'
                };
                const label = catLabels[catRadio.value] || catRadio.value;

                container.appendChild(createChip(label, () => {
                    // Reset to 'all'
                    const allRadio = document.querySelector('input[name="category"][value="all"]');
                    if (allRadio) allRadio.checked = true;
                    // Reset UI (show full list if hidden by Focus Mode)
                    const catOptions = document.querySelector('.filter-options');
                    const catGroup = document.querySelector('.filter-group h4');
                    if (catOptions) catOptions.style.display = 'block';
                    if (catGroup) catGroup.style.display = 'block';
                    // Check if back link exists and remove?
                    // Not strictly necessary as filterProducts re-runs logic but focus mode logic is separate.
                    // Ideally we refresh page title too.
                    pageTitle.innerText = 'Cat√°logo de Productos';
                    filterProducts();
                }));
            }

            // Brand Filters
            checkedBrands.forEach(cb => {
                hasFilters = true;
                container.appendChild(createChip(cb.value, () => {
                    cb.checked = false;
                    filterProducts();
                }));
            });

            // Clear All Button
            if (hasFilters) {
                const clearBtn = document.createElement('button');
                clearBtn.className = 'clear-all-filters';
                clearBtn.innerText = 'Limpiar filtros';
                clearBtn.onclick = () => {
                    searchInput.value = '';
                    const allRadio = document.querySelector('input[name="category"][value="all"]');
                    if (allRadio) allRadio.checked = true;
                    document.querySelectorAll('input[name="brand"]').forEach(cb => cb.checked = false);

                    // Reset UI for Focus Mode
                    const catOptions = document.querySelector('.filter-options');
                    const catGroup = document.querySelector('.filter-group h4');
                    if (catOptions) catOptions.style.display = 'block';
                    if (catGroup) catGroup.style.display = 'block';
                    pageTitle.innerText = 'Cat√°logo de Productos';

                    filterProducts();
                };
                container.appendChild(clearBtn);
            }
        }

        function createChip(text, onClose) {
            const chip = document.createElement('div');
            chip.className = 'filter-chip';
            chip.innerHTML = `<span>${text}</span> <i class="fa-solid fa-times"></i>`;
            chip.querySelector('i').onclick = (e) => {
                e.stopPropagation();
                onClose();
            };
            return chip;
        }

        function toggleMobileFilters() {
            const sidebar = document.getElementById('filterSidebar');
            // Check if overlay exists, if not create/select it properly
            let overlay = document.querySelector('.filter-overlay');
            if (sidebar) sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
        }

        // URL Params Logic with Focus Mode
        const urlParams = new URLSearchParams(window.location.search);
        const codeParam = urlParams.get('cat');

        if (codeParam) {
            // Check the proper radio
            const radio = document.querySelector(`input[name="category"][value="${codeParam}"]`);
            if (radio) {
                radio.checked = true;

                // Update Title
                if (codeParam === 'toner') pageTitle.innerText = 'Cat√°logo de T√≥ners';
                if (codeParam === 'papeleria') pageTitle.innerText = 'Cat√°logo de Papeler√≠a';
                if (codeParam === 'accesorios') pageTitle.innerText = 'Accesorios de C√≥mputo';

                // FOCUS MODE: Hide other categories and show navigation back
                const catGroup = document.querySelector('.filter-group h4'); // "Categor√≠as" label
                const catOptions = document.querySelector('.filter-options'); // Container of radios

                if (catGroup && catOptions) {
                    // Hide the standard list
                    catOptions.style.display = 'none';
                    catGroup.style.display = 'none';

                    // Create "Back" button container
                    const backContainer = document.createElement('div');
                    backContainer.innerHTML = `
                        <a href="catalogo.html" style="display:flex; align-items:center; gap:8px; color:var(--ic-text-gray); text-decoration:none; margin-bottom:1rem; font-size:0.9rem;">
                            <i class="fa-solid fa-arrow-left"></i> Ver todas las categor√≠as
                        </a>
                        <h4 style="margin-bottom:0.5rem; color:var(--ic-magenta);">${pageTitle.innerText}</h4>
                        <div style="height:2px; width:40px; background:var(--ic-magenta); margin-bottom:1.5rem;"></div>
                    `;

                    // Insert before the Marcas group
                    const marcasGroup = document.querySelectorAll('.filter-group')[1]; // Assume Marcas is second
                    if (marcasGroup) {
                        marcasGroup.parentNode.insertBefore(backContainer, marcasGroup);
                    }
                }
            }
        }

        // Event Listeners
        searchInput.addEventListener('input', filterProducts);
        // Radio Button Listener
        document.querySelectorAll('input[name="category"]').forEach(radio => {
            radio.addEventListener('change', () => {
                filterProducts();
                const val = radio.value;
                if (val === 'all') pageTitle.innerText = 'Cat√°logo de Productos';
                else if (val === 'toner') pageTitle.innerText = 'Cat√°logo de T√≥ners';
                else if (val === 'papeleria') pageTitle.innerText = 'Cat√°logo de Papeler√≠a';
                else if (val === 'accesorios') pageTitle.innerText = 'Accesorios de C√≥mputo';
            });
        });
        sortFilter.addEventListener('change', filterProducts);

        // Sticky Search Bar Scroll Logic
        window.addEventListener('scroll', () => {
            const searchContainer = document.querySelector('.search-container');
            const heroHeight = document.querySelector('.catalog-hero').offsetHeight;
            const scrollPos = window.scrollY;

            if (scrollPos > heroHeight - 100) {
                searchContainer.classList.add('sticky');
            } else {
                searchContainer.classList.remove('sticky');
            }

            // Scroll to Top Button Visibility
            if (scrollPos > 500) {
                scrollToTopBtn.classList.add('show');
            } else {
                scrollToTopBtn.classList.remove('show');
            }
        });



        // Initialize
        updateCartCount();

        // Cargar productos con cache-buster para evitar versiones viejas
        const script = document.createElement('script');
        script.src = `assets/js/productos.js?v=${Date.now()}`;
        script.onload = () => {
            console.log("Database loaded!");
            loadProducts();
        };
        document.body.appendChild(script);

    </script>

</body>